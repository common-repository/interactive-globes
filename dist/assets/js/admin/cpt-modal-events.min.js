function jsonToObject(t){const e={};for(let n=0;n<t.length;n++){setObjectValue(e,t[n][0],t[n][1])}return e}function setObjectValue(t,e,n){const r=e.split("[").map(t=>t.replace("]",""));let o=t;for(let t=0;t<r.length;t++){const e=r[t];t===r.length-1?o[e]=n:(o[e]||(o[e]={}),o=o[e])}}async function submit_unserialized(t,e,n){try{const r=itt_globe_rest.url+t+"/"+e,o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":itt_globe_rest.nonce},body:JSON.stringify(n)});if(!o.ok)throw new Error("Network response was not OK");return await o.json()}catch(t){console.error("There has been a problem with your fetch operation:",t)}}async function submit_data_as_meta(t,e,n){let r={meta:n};return await submit_unserialized(t,e,r)}async function submit_unserialized_meta_objet(t,e,n){const r={};for(let o in n)if(n.hasOwnProperty(o)){if("object"!=typeof n[o]||null===n[o])return r[o]=n[o],await submit_data_as_meta(t,e,r);submit_unserialized_meta_objet(t,e,n[o])}}async function submit_meta(t,e,n,r){const o=[],a=Array.from(n),i={};a.forEach(([t,e])=>{t=t.replace("[]",""),i[t]?(Array.isArray(i[t])||(i[t]=[i[t]]),i[t].push(e)):i[t]=e});const s=Object.entries(i);return console.log(a),console.log(s),Object.entries(r).forEach((async function(n){var r=n[0],a=n[1];if(void 0!==a.args){if("unserialize"===a.args.data_type){let n=jsonToObject(s.filter(([t])=>t.startsWith(r)));o.push(submit_unserialized_meta_objet(t,e,n))}if("serialize"===a.args.data_type){let n=jsonToObject(s.filter(([t])=>t.startsWith(r)));o.push(submit_data_as_meta(t,e,n))}}})),await Promise.all(o),!0}async function submit_cpt(t){const e=t.get("cpt_post_id");0==e&&(e=null);const n=t.get("relationship_parent_id");let r=Array.from(t).filter(([t])=>t.includes(itt_globe_meta.relationship_key));r.length>0&&r[0].hasOwnProperty(0)&&r[0].hasOwnProperty(1)&&""===r[0][1]&&t.set(r[0][0],n);let o=t.get("extra_values");o=JSON.parse(o);let a=t.get("cpt_meta_boxes");a=JSON.parse(a);const i=t.get("post_type");if(!i)return;const s=o.map(async n=>{let r={};return r[n]=t.get(n),r.status="publish",await submit_unserialized(i,e,r)}),l=await Promise.all(s);if(l.length>0){const n=l[0];0==e&&void 0!==n.id&&(e=n.id),await submit_meta(i,e,t,a)}return e}async function saveModal(t){const e=document.querySelector("#"+t+"_modal iframe");if(!e)return null;let n=e.contentWindow.document.getElementById("cpt-post"),r=new FormData(n);try{return await submit_cpt(r)}catch(t){console.error("Error:",t)}}function notifyParent(t,e){let n={message:t,params:e};window.parent.postMessage(n,"*")}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".js-modal-save").forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault();let e=null;const n=this.getAttribute("data-post_type"),r=this.getAttribute("data-parent_id");this.innerHTML="Saving...",this.setAttribute("disabled","disabled"),saveModal(n).then(o=>void 0===o?null:(e=o,notifyParent("refresh-cpt-list",{post_type:n,parent_id:r}),t.target.innerHTML="Save",t.target.removeAttribute("disabled"),closeModal(n),e)).catch(t=>(console.error("Error processing items:",t),notifyParent("form-with-error",{error:t,post_type:n}),null))}))}))}));const pencilIcons=document.querySelectorAll(".edit_mode__trigger");pencilIcons.forEach(t=>{t.addEventListener("click",()=>{t.parentNode.querySelectorAll(".modal__title__input").forEach((function(t){t.classList.toggle("visible")})),t.parentNode.querySelectorAll(".edit_mode__static").forEach((function(t){t.classList.toggle("invisible")}))})});