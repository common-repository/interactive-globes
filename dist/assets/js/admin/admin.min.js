const globe_ut_prepareURL=function(e){if("string"!=typeof e)return e;var t;(e=e.replace(/&amp;/gi,"&")).replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)}));try{t=new URL(e)}catch(e){t=!1}return t&&![null,"http:","https:","mailto:","tel:"].includes(t.protocol)?(console.log("URL protocol not allowed"),""):e};function setupClickEvent(e,t,i){if("none"===i.action)return;const n=i.action;n&&"function"==typeof window.ittGlobes.clickActions[n]&&window.ittGlobes.clickActions[n](e,t,i),ittGlobeData.isAdmin||("open_url"!==i.action&&"open_url_new"!==i.action||(i.content=globe_ut_prepareURL(i.content)),"open_url"===i.action&&""!==i.content?document.location=i.content:"open_url_new"===i.action&&""!==i.content&&window.open(i.content))}function addShortcodeCopyEvent(){document.getElementById("ittglobe-copy-button").addEventListener("click",(function(){const e=document.getElementById("meta_box_shortcode-code").innerText;navigator.clipboard?navigator.clipboard.writeText(e):document.execCommand("copy"),this.classList.remove("dashicons-admin-page"),this.classList.add("dashicons-yes"),setTimeout(()=>{this.classList.remove("dashicons-yes"),this.classList.add("dashicons-admin-page")},2e3)}))}let ittGlobesAdmin={preview:{},globeMeta:{},cptTabIndex:{itt_globe_point:2,itt_globe_dotlabel:3,itt_globe_region:4,itt_globe_line:5},init:function(){ittGlobesAdmin.buildPreview(),ittGlobesAdmin.setupGlobeReady(),ittGlobesAdmin.setMeta()},setMeta:function(){let e=document.querySelector(".itt_globe_render");e&&(ittGlobesAdmin.meta=e.dataset.globe_meta)},round:function(e){return Math.round(100*e)/100},setupGlobeReady:function(){document.addEventListener("adminGlobeReady",(function(){let e=Object.values(ittGlobes.globesIndex)[0];const t=JSON.parse(ittGlobesAdmin.meta);ittGlobesAdmin.preview.centerCoordinates={lat:0,lng:0,altitude:1.7},e.ringColor(()=>e=>`rgba(255,100,50,${1-e})`).ringMaxRadius(3.5).ringAltitude(.006).ringPropagationSpeed(5).ringRepeatPeriod(400/3),e.onGlobeClick((function(t,i){t.latitude=ittGlobesAdmin.round(t.lat),t.longitude=ittGlobesAdmin.round(t.lng);const n={lat:t.lat,lng:t.lng};e.ringsData([...e.ringsData(),n]),setTimeout(()=>e.ringsData(e.ringsData().filter(e=>e!==n)),400),ittGlobesAdmin.preview.clickedCoordinates=t,delete ittGlobesAdmin.preview.clickedElement,delete ittGlobesAdmin.preview.clickedDataset,ittGlobesAdmin.updateClickedPreviewInfo()})),e.onZoom((function(e){ittGlobesAdmin.preview.centerCoordinates=e,ittGlobesAdmin.updateCenterPreviewInfo()})),e.onPointClick((function(i,n,o){ittGlobesAdmin.preview.clickedElement=Object.assign({},i),ittGlobesAdmin.preview.clickedElement.type="Point",ittGlobesAdmin.preview.clickedElement.post_type="itt_globe_point",delete ittGlobesAdmin.preview.clickedElement.__threeObj,delete ittGlobesAdmin.preview.clickedCoordinates,delete ittGlobesAdmin.preview.clickedDataset,ittGlobesAdmin.updateClickedPreviewInfo(),setupClickEvent(e,t,i)})),e.onLabelClick((function(i,n,o){ittGlobesAdmin.preview.clickedElement=Object.assign({},i),ittGlobesAdmin.preview.clickedElement.type="Dot Label",ittGlobesAdmin.preview.clickedElement.post_type="itt_globe_dotlabel",delete ittGlobesAdmin.preview.clickedElement.__threeObj,delete ittGlobesAdmin.preview.clickedCoordinates,delete ittGlobesAdmin.preview.clickedDataset,ittGlobesAdmin.updateClickedPreviewInfo(),setupClickEvent(e,t,i)}))}))},setCenter:function(e){if(e.target){document.getElementsByName("globe_info[altitude]")[0].value=e.target.dataset.altitude,document.getElementsByName("globe_info[centerCoordinates][latitude]")[0].value=e.target.dataset.lat,document.getElementsByName("globe_info[centerCoordinates][longitude]")[0].value=e.target.dataset.lng,ittGlobesAdmin.onChange(),e.target.innerHTML=itt_admin_labels.newCenterSaved,e.target.setAttribute("disabled","disabled"),setTimeout((function(){e.target.innerHTML=itt_admin_labels.setInitialCenter,e.target.removeAttribute("disabled")}),2e3)}},updateClickedPreviewInfo:function(){let e=ittGlobesAdmin.preview;if(void 0!==e.clickedCoordinates){ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .itt_globe_preview_title").innerHTML="Clicked Location";let t=ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .inside .itt_globe_preview_data"),i='<span class="ittglobe_lat_s">Lat: </span><span class="ittglobe_lat">'+e.clickedCoordinates.latitude+'</span><span class="ittglobe_lng_s">Long: </span><span class="ittglobe_lng">'+e.clickedCoordinates.longitude+"</span>";t.innerHTML=i,ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .itt_globe_preview_action_edit").style.display="none";let n=ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .inside .itt_globe_preview_action_add_new"),o=n.dataset.latitude,l=n.dataset.longitude;Object.keys(n.dataset).forEach(e=>{delete n.dataset[e]}),n.dataset.prevlatitude=o,n.dataset.prevlongitude=l,n.dataset.latitude=e.clickedCoordinates.latitude,n.dataset.longitude=e.clickedCoordinates.longitude,void 0!==ittGlobesAdmin.preview.clickedDataset&&(Object.keys(ittGlobesAdmin.preview.clickedDataset).forEach(e=>{n.dataset[e]=ittGlobesAdmin.preview.clickedDataset[e]}),delete ittGlobesAdmin.preview.clickedDataset),n.style.display="inline-block"}if(void 0!==e.clickedElement){ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .itt_globe_preview_title").innerHTML="Clicked "+e.clickedElement.type+" : "+e.clickedElement.title;let t=ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .inside .itt_globe_preview_data"),i='<span class="ittglobe_lat_s">Lat: </span><span class="ittglobe_lat">'+ittGlobesAdmin.round(e.clickedElement.coordinates.latitude)+'</span><span class="ittglobe_lng_s">Long: </span><span class="ittglobe_lng">'+ittGlobesAdmin.round(e.clickedElement.coordinates.longitude)+"</span>";if(t.innerHTML=i,"itt_globe_point"===e.clickedElement.post_type||"itt_globe_dotlabel"===e.clickedElement.post_type||void 0!==e.clickedElement.post_id){let t=ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .itt_globe_preview_action_edit");t.dataset.id=e.clickedElement.post_id?e.clickedElement.post_id:e.clickedElement.id,t.dataset.post_type=e.clickedElement.post_type,t.style.display="inline-block";let i=ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_clicked .inside .itt_globe_preview_action_add_new");i.style.display="inline-block",i.dataset.prevlatitude=i.dataset.latitude,i.dataset.prevlongitude=i.dataset.longitude,i.dataset.latitude=ittGlobesAdmin.round(e.clickedElement.coordinates.latitude),i.dataset.longitude=ittGlobesAdmin.round(e.clickedElement.coordinates.longitude)}}},updateCenterPreviewInfo:function(){let e=ittGlobesAdmin.preview;e.centerCoordinates.latitude=ittGlobesAdmin.round(ittGlobesAdmin.preview.centerCoordinates.lat),e.centerCoordinates.longitude=ittGlobesAdmin.round(ittGlobesAdmin.preview.centerCoordinates.lng),e.centerCoordinates.altitude=ittGlobesAdmin.round(ittGlobesAdmin.preview.centerCoordinates.altitude);let t=ittGlobesAdmin.infoContainer.querySelector("#itt_globe_preview_data_center .inside .itt_globe_preview_data"),i='<span class="ittglobe_lat_s">Lat: </span><span class="ittglobe_lat">'+e.centerCoordinates.latitude+'</span><span class="ittglobe_lng_s">Long: </span><span class="ittglobe_lng">'+e.centerCoordinates.longitude+'</span><span class="ittglobe_altitude_s">Scale: </span><span class="ittglobe_altitude">'+e.centerCoordinates.altitude+"</span>";ittGlobesAdmin.setCenterButton.dataset.lat=e.centerCoordinates.lat,ittGlobesAdmin.setCenterButton.dataset.lng=e.centerCoordinates.lng,ittGlobesAdmin.setCenterButton.dataset.altitude=e.centerCoordinates.altitude,t.innerHTML=i},buildPreview:function(){let e=".itt_globe_info input, .itt_globe_info select, .itt_globe_info textarea",t=document.querySelectorAll(e);t.forEach((function(e){e.onchange=ittGlobesAdmin.onChange})),document.querySelectorAll(".csf-cloneable-add").forEach((function(i){i.addEventListener("click",(function(i){t.forEach((function(e){e.onchange=null})),setTimeout((function(){t=document.querySelectorAll(e),t.forEach((function(e){e.onchange=ittGlobesAdmin.onChange}))}),500)}))})),ittGlobesAdmin.preview.centerCoordinates={lat:void 0===ittGlobesAdmin.globeMeta.centerCoordinates?0:ittGlobesAdmin.globeMeta.centerCoordinates.latitude,lng:void 0===ittGlobesAdmin.globeMeta.centerCoordinates?0:ittGlobesAdmin.globeMeta.centerCoordinates.longitude,altitude:void 0===ittGlobesAdmin.globeMeta.altitude?1.7:ittGlobesAdmin.globeMeta.altitude};let i=document.getElementsByClassName("itt_globe_preview_info");i.length<1?ittGlobesAdmin.infoContainer=null:(ittGlobesAdmin.infoContainer=i[0],ittGlobesAdmin.setCenterButton=document.querySelector(".itt_globe_preview_info #itt_globe_preview_data_center .itt_globe_preview_action button"),ittGlobesAdmin.setCenterButton.addEventListener("click",ittGlobesAdmin.setCenter),ittGlobesAdmin.updateCenterPreviewInfo())},onChange:function(){let e=document.querySelector(".itt_globe_preview");e instanceof HTMLElement&&e.classList.add("itt_globe_preview_needs_update")},addNew:function(e){if(e){let t=document.getElementById("post_ID").value;console.log("Add new "+JSON.stringify(e.dataset)+" dataType:"+e.value+" parentGlobe: "+t);let i=ittGlobesAdmin.cptTabIndex[e.value],n=document.querySelectorAll(".csf-nav-metabox ul li a");if(n&&n[i].click(),"undefined"!=typeof addNew){let i=[];for(const t in e.dataset)e.dataset.hasOwnProperty(t)&&i.push([t,e.dataset[t]]);i.push(["post_type",e.value]),i.push(["parent_id",t]),addNew(e.value,t,i),e.value=""}else console.log("something went wrong")}},edit:function(e){if(e&&(console.log("edit "+JSON.stringify(e.dataset)),"undefined"!=typeof editEntry)){let t=[];for(const i in e.dataset)e.dataset.hasOwnProperty(i)&&t.push([i,e.dataset[i]]);let i=ittGlobesAdmin.cptTabIndex[e.dataset.post_type],n=document.querySelectorAll(".csf-nav-metabox ul li a");n&&n[i].click();let o=document.getElementById("post_ID").value;editEntry(e.dataset.post_type,e.dataset.id,o,t)}}};ittGlobesAdmin.init(),window.ittGlobesAdmin=ittGlobesAdmin,addShortcodeCopyEvent();export{ittGlobesAdmin};